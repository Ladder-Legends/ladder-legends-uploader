(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();let d=null;async function S(){var e,t,n;return d||((e=window.__TAURI_INTERNALS__)!=null&&e.invoke?(d=window.__TAURI_INTERNALS__.invoke,console.log("[DEBUG] Using __TAURI_INTERNALS__.invoke"),d):(n=(t=window.__TAURI__)==null?void 0:t.core)!=null&&n.invoke?(d=window.__TAURI__.core.invoke,console.log("[DEBUG] Using __TAURI__.core.invoke"),d):(console.error("[DEBUG] Tauri not available yet, waiting..."),await new Promise(a=>setTimeout(a,100)),S()))}function p(){if(!d)throw new Error("Tauri not initialized. Call initTauri() first.");return d}const f={detecting:null,code:null,authenticated:null,settings:null,error:null};function z(){f.detecting=document.getElementById("detecting-state"),f.code=document.getElementById("code-state"),f.authenticated=document.getElementById("authenticated-state"),f.settings=document.getElementById("settings-state"),f.error=document.getElementById("error-state")}function E(e){Object.values(f).forEach(n=>{n&&n.classList.add("hidden")});const t=f[e];t&&t.classList.remove("hidden")}function w(e){console.log("[DEBUG] Showing error:",e);const t=document.getElementById("error-message");t&&(t.textContent=e),E("error"),setTimeout(()=>{var a;const n=document.getElementById("retry-btn");if(n){const o=n.cloneNode(!0);(a=n.parentNode)==null||a.replaceChild(o,n),o.addEventListener("click",()=>{console.log("[DEBUG] Retry button clicked"),location.reload()})}},100)}const D={};function P(){const e=D==null?void 0:D.VITE_API_HOST,t=typeof window<"u"?window.LADDER_LEGENDS_API_HOST:void 0,a=e||t||"https://www.ladderlegendsacademy.com";return console.log("[CONFIG] getApiHost() called:"),console.log("  - VITE_API_HOST:",e),console.log("  - window.LADDER_LEGENDS_API_HOST:",t),console.log("  - Selected:",a),a}P();const F=8e3,H=100;function V(e){const t=document.getElementById(e);if(!t||!t.parentNode)return null;const n=t.cloneNode(!0);return t.parentNode.replaceChild(n,t),n}function B(e,t,n=H){setTimeout(()=>{const a=V(e);a&&a.addEventListener("click",t)},n)}function b(e){return document.getElementById(e)}function v(e,t){const n=b(e);n&&(n.textContent=t)}function L(e,t){const n=b(e);n&&(n.src=t)}async function q(e){console.log("[DEBUG] detectWithTimeout starting...");const t=e("detect_replay_folder").then(a=>(console.log("[DEBUG] invoke SUCCESS:",a),a)).catch(a=>{throw console.error("[DEBUG] invoke ERROR:",a),a}),n=new Promise((a,o)=>setTimeout(()=>{console.log("[DEBUG] Timeout reached!"),o("timeout")},F));return Promise.race([t,n])}function M(e){const t=document.getElementById("detecting-state");if(!t)return;const n=t.querySelector(".status");n&&(n.textContent="Could not automatically find your SC2 replay folder.");const a=t.querySelector(".spinner");if(a&&(a.style.display="none"),!document.getElementById("manual-pick-btn")){const o=document.createElement("button");o.id="manual-pick-btn",o.className="btn btn-primary",o.textContent="Choose Folder Manually",t.appendChild(o),o.addEventListener("click",()=>A())}}async function A(){try{return await p()("pick_replay_folder_manual")}catch(e){return e!=="No folder selected"&&w(`Failed to select folder: ${e}`),null}}const W="modulepreload",j=function(e){return"/"+e},I={},U=function(t,n,a){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),s=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.allSettled(n.map(c=>{if(c=j(c),c in I)return;I[c]=!0;const k=c.endsWith(".css"),N=k?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${N}`))return;const u=document.createElement("link");if(u.rel=k?"stylesheet":W,k||(u.as="script"),u.crossOrigin="",u.href=c,s&&u.setAttribute("nonce",s),document.head.appendChild(u),k)return new Promise((O,$)=>{u.addEventListener("load",O),u.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(r){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=r,window.dispatchEvent(s),!s.defaultPrevented)throw r}return o.then(r=>{for(const s of r||[])s.status==="rejected"&&i(s.reason);return t().catch(i)})};function R(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}let l={isUploading:!1,current:null,total:null,filename:null,completedCount:null,showCompleted:!1,checkingCount:null,totalReplays:null,currentBatchGameType:null,currentBatchPlayerName:null,currentBatchCount:null},T=null;function g(e,t){const n=document.getElementById("upload-status"),a=document.getElementById("batch-game-type"),o=document.getElementById("batch-player-name");!n||!a||!o||(e&&t?(n.classList.remove("hidden"),a.textContent=e,o.textContent=R(t)):n.classList.add("hidden"))}function h(e,t,n){const a=document.getElementById("replay-progress"),o=document.getElementById("replay-filename");!a||!o||(e!==null&&t!==null&&n?(a.textContent=`[${e}/${t}]`,o.textContent=R(n)):(a.textContent="",o.textContent=""))}function y(e,t=!1){const n=document.getElementById("watching-status");n&&(n.textContent=e,t?n.classList.add("fade-out"):n.classList.remove("fade-out"))}function m(){if(l.showCompleted&&l.completedCount!==null){const e=l.completedCount,t=l.totalReplays!==null?` (${l.totalReplays} total)`:"",n=e>0?`Uploaded ${e} new replay${e===1?"":"s"}${t}`:`No new replays to upload${t}`;y(n,!1),g(null,null),h(null,null,null)}else if(l.isUploading)l.current!==null&&l.total!==null&&l.filename?(g(l.currentBatchGameType,l.currentBatchPlayerName),h(l.current,l.total,l.filename),y("",!1)):l.total!==null?(y(`Found ${l.total} new replay${l.total===1?"":"s"} to upload`,!1),g(null,null),h(null,null,null)):l.checkingCount!==null?(y(`Checking ${l.checkingCount} replay${l.checkingCount===1?"":"s"} for duplicates...`,!1),g(null,null),h(null,null,null)):(y("Scanning for replays...",!1),g(null,null),h(null,null,null));else{const e=l.totalReplays!==null?` (${l.totalReplays} replays tracked)`:"";y(`Waiting for new replays${e}`,!1),g(null,null),h(null,null,null)}}function K(e){console.log("[DEBUG] Upload started, limit:",e.limit),l.isUploading=!0,l.current=null,l.total=null,l.filename=null,l.showCompleted=!1,l.checkingCount=null,m()}function Y(e){console.log("[DEBUG] Checking hashes:",e.count),l.isUploading=!0,l.checkingCount=e.count,m()}function J(e){console.log("[DEBUG] Check complete:",e.new_count,"new,",e.existing_count,"existing"),l.total=e.new_count,l.checkingCount=null,l.totalReplays=e.new_count+e.existing_count,m()}function Q(e){console.log("[DEBUG] Batch started:",e.game_type,"for",e.player_name,"-",e.count,"replays"),l.currentBatchGameType=e.game_type,l.currentBatchPlayerName=e.player_name,l.currentBatchCount=e.count,m()}function X(e){console.log("[DEBUG] Upload progress:",e.current,"of",e.total,"-",e.filename,`(${e.game_type} for ${e.player_name})`),l.isUploading=!0,l.current=e.current,l.total=e.total,l.filename=e.filename,l.currentBatchGameType=e.game_type,l.currentBatchPlayerName=e.player_name,m()}function Z(e){console.log("[DEBUG] Batch completed:",e.game_type,"for",e.player_name,"-",e.count,"replays")}function ee(e){console.log("[DEBUG] Upload complete:",e.count,"uploaded"),l.isUploading=!1,l.current=null,l.total=null,l.filename=null,l.completedCount=e.count,l.showCompleted=!0,l.checkingCount=null,l.currentBatchGameType=null,l.currentBatchPlayerName=null,l.currentBatchCount=null,m(),T&&clearTimeout(T),T=setTimeout(()=>{const t=document.querySelector("#authenticated-state .status");t&&(t.classList.add("fade-out"),setTimeout(()=>{l.showCompleted=!1,m()},1e3))},3e3)}async function te(){try{const{listen:e}=await U(async()=>{const{listen:t}=await import("./event-OkWMoV8X.js");return{listen:t}},[]);await e("upload-start",t=>{K(t.payload)}),await e("upload-checking",t=>{Y(t.payload)}),await e("upload-check-complete",t=>{J(t.payload)}),await e("upload-batch-start",t=>{Q(t.payload)}),await e("upload-progress",t=>{X(t.payload)}),await e("upload-batch-complete",t=>{Z(t.payload)}),await e("upload-complete",t=>{ee(t.payload)}),console.log("[DEBUG] Upload progress listeners initialized")}catch(e){console.error("[DEBUG] Failed to initialize upload progress listeners:",e)}}async function x(e){try{console.log("[DEBUG] Initializing upload system...");const t=p(),n=await t("load_folder_path");if(!n){console.error("[DEBUG] No folder path saved");return}await te(),console.log("[DEBUG] Upload progress listeners initialized");const a=P();console.log("[DEBUG] Using base URL:",a),await t("initialize_upload_manager",{replayFolder:n,baseUrl:a,accessToken:e}),console.log("[DEBUG] Upload manager initialized"),await t("start_file_watcher"),console.log("[DEBUG] File watcher started"),console.log("[DEBUG] Starting initial scan...");const o=await t("scan_and_upload_replays",{limit:10});console.log(`[DEBUG] Initial scan complete - uploaded ${o} replays`)}catch(t){console.error("[DEBUG] Failed to initialize upload system:",t)}}async function C(){try{E("detecting");const t=await p()("request_device_code");v("user-code",t.user_code),window.verificationUrl=t.verification_uri,E("code"),B("open-browser-btn",()=>ne()),B("check-auth-btn",()=>oe(t.device_code))}catch(e){w(`Failed to request device code: ${e}`)}}async function ne(){try{if(!window.verificationUrl){console.error("No verification URL available");return}await p()("open_browser",{url:window.verificationUrl})}catch(e){console.error("Failed to open browser:",e)}}async function oe(e){const t=document.getElementById("check-auth-btn");if(!t)return;const n=t.textContent||"Check Authorization";try{t.disabled=!0,t.textContent="Checking...";const a=p(),o=await a("poll_device_authorization",{deviceCode:e});v("username",o.user.username),o.user.avatar_url&&L("user-avatar",o.user.avatar_url),E("authenticated"),await a("save_auth_tokens",{accessToken:o.access_token,refreshToken:o.refresh_token||null,expiresAt:o.expires_at||null,username:o.user.username||null,avatarUrl:o.user.avatar_url||null});const{openSettings:i}=await U(async()=>{const{openSettings:r}=await import("./settings-DKEsfcfy.js");return{openSettings:r}},[]);B("settings-btn",()=>i());try{const{listen:r}=await U(async()=>{const{listen:s}=await import("./event-OkWMoV8X.js");return{listen:s}},[]);await r("open-settings",()=>{i()})}catch(r){console.error("[DEBUG] Failed to setup settings event listener:",r)}await x(o.access_token)}catch(a){if(t.disabled=!1,t.textContent=n,a==="pending"){const o=document.querySelector("#code-state .status");o&&(o.textContent="Not authorized yet. Please complete authorization on the website.",setTimeout(()=>{o.textContent="After completing activation, click below:"},3e3));return}if(a==="expired"){w("Device code expired. Please try again.");return}if(a==="denied"){w("Authorization denied. Please try again.");return}console.error("Authorization error:",a),w(`Authorization failed: ${a}`)}}async function le(e){try{console.log("[DEBUG] Found saved auth tokens, verifying...");const t=p(),n=await t("verify_auth_token",{accessToken:e.access_token});if(console.log("[DEBUG] Token verification result:",n),n){E("authenticated"),e.user?(v("username",e.user.username||"Logged In"),e.user.avatar_url&&L("user-avatar",e.user.avatar_url)):v("username","Logged In");const{openSettings:a}=await U(async()=>{const{openSettings:o}=await import("./settings-DKEsfcfy.js");return{openSettings:o}},[]);B("settings-btn",()=>a());try{const{listen:o}=await U(async()=>{const{listen:i}=await import("./event-OkWMoV8X.js");return{listen:i}},[]);await o("open-settings",()=>{a()})}catch(o){console.error("[DEBUG] Failed to setup settings event listener:",o)}return await x(e.access_token),!0}else return console.log("[DEBUG] Token is invalid, clearing and re-authenticating..."),await t("clear_auth_tokens"),!1}catch(t){return console.error("[DEBUG] Token verification failed:",t),await p()("clear_auth_tokens"),!1}}function ae(){B("retry-btn",()=>{console.log("[DEBUG] Retry button clicked"),location.reload()})}let G=!1,_=!1;async function re(){if(console.log("[DEBUG] init() called"),G){console.log("[DEBUG] Already initializing, skipping duplicate init() call");return}if(_){console.log("[DEBUG] Already initialized, skipping init() call");return}G=!0;try{z(),console.log("[DEBUG] Checking for Tauri API...");const e=await S();console.log("[DEBUG] invoke function loaded:",typeof e);const t=await e("load_auth_tokens");if(console.log("[DEBUG] Saved auth tokens:",t?"Found":"Not found"),t&&t.access_token&&await le(t)){_=!0;return}const n=await e("load_folder_path");if(console.log("[DEBUG] Saved folder path:",n),n){console.log("[DEBUG] Using saved folder, starting device auth..."),await C(),_=!0;return}E("detecting"),console.log("[DEBUG] Showing detecting state"),console.log("[DEBUG] Starting folder detection...");const a=await q(e);console.log("[DEBUG] Detection result:",a),a&&(console.log("[DEBUG] Found folder, starting device auth..."),await C(),_=!0)}catch(e){console.error("[DEBUG] Detection error:",e),M(),setTimeout(()=>{const t=document.getElementById("manual-pick-btn");t&&t.addEventListener("click",async()=>{await A()&&(await C(),_=!0)})},100)}finally{G=!1}ae()}window.addEventListener("DOMContentLoaded",()=>{console.log("[DEBUG] DOMContentLoaded fired!"),re()});export{b as a,B as b,w as c,p as g,E as s};
