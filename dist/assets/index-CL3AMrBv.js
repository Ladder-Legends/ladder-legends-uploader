(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=o(n);fetch(n.href,l)}})();let d=null;async function C(){var e,t,o;return d||((e=window.__TAURI_INTERNALS__)!=null&&e.invoke?(d=window.__TAURI_INTERNALS__.invoke,console.log("[DEBUG] Using __TAURI_INTERNALS__.invoke"),d):(o=(t=window.__TAURI__)==null?void 0:t.core)!=null&&o.invoke?(d=window.__TAURI__.core.invoke,console.log("[DEBUG] Using __TAURI__.core.invoke"),d):(console.error("[DEBUG] Tauri not available yet, waiting..."),await new Promise(r=>setTimeout(r,100)),C()))}function p(){if(!d)throw new Error("Tauri not initialized. Call initTauri() first.");return d}const f={detecting:null,code:null,authenticated:null,settings:null,error:null};function L(){f.detecting=document.getElementById("detecting-state"),f.code=document.getElementById("code-state"),f.authenticated=document.getElementById("authenticated-state"),f.settings=document.getElementById("settings-state"),f.error=document.getElementById("error-state")}function g(e){Object.values(f).forEach(o=>{o&&o.classList.add("hidden")});const t=f[e];t&&t.classList.remove("hidden")}function h(e){console.log("[DEBUG] Showing error:",e);const t=document.getElementById("error-message");t&&(t.textContent=e),g("error")}const E={};function D(){const e=E==null?void 0:E.VITE_API_HOST,t=typeof window<"u"?window.LADDER_LEGENDS_API_HOST:void 0,r=e||t||"https://ladderlegendsacademy.com";return console.log("[CONFIG] getApiHost() called:"),console.log("  - VITE_API_HOST:",e),console.log("  - window.LADDER_LEGENDS_API_HOST:",t),console.log("  - Selected:",r),r}D();const R=8e3,x=100;function N(e){const t=document.getElementById(e);if(!t||!t.parentNode)return null;const o=t.cloneNode(!0);return t.parentNode.replaceChild(o,t),o}function _(e,t,o=x){setTimeout(()=>{const r=N(e);r&&r.addEventListener("click",t)},o)}function T(e){return document.getElementById(e)}function w(e,t){const o=T(e);o&&(o.textContent=t)}function S(e,t){const o=T(e);o&&(o.src=t)}async function O(e){console.log("[DEBUG] detectWithTimeout starting...");const t=e("detect_replay_folder").then(r=>(console.log("[DEBUG] invoke SUCCESS:",r),r)).catch(r=>{throw console.error("[DEBUG] invoke ERROR:",r),r}),o=new Promise((r,n)=>setTimeout(()=>{console.log("[DEBUG] Timeout reached!"),n("timeout")},R));return Promise.race([t,o])}function $(e){const t=document.getElementById("detecting-state");if(!t)return;const o=t.querySelector(".status");o&&(o.textContent="Could not automatically find your SC2 replay folder.");const r=t.querySelector(".spinner");if(r&&(r.style.display="none"),!document.getElementById("manual-pick-btn")){const n=document.createElement("button");n.id="manual-pick-btn",n.className="btn btn-primary",n.textContent="Choose Folder Manually",t.appendChild(n),n.addEventListener("click",()=>G())}}async function G(){try{return await p()("pick_replay_folder_manual")}catch(e){return e!=="No folder selected"&&h(`Failed to select folder: ${e}`),null}}const z="modulepreload",F=function(e){return"/"+e},B={},v=function(t,o,r){let n=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(o.map(c=>{if(c=F(c),c in B)return;B[c]=!0;const y=c.endsWith(".css"),P=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${P}`))return;const u=document.createElement("link");if(u.rel=y?"stylesheet":z,y||(u.as="script"),u.crossOrigin="",u.href=c,s&&u.setAttribute("nonce",s),document.head.appendChild(u),y)return new Promise((b,A)=>{u.addEventListener("load",b),u.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${c}`)))})}))}function l(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return n.then(a=>{for(const s of a||[])s.status==="rejected"&&l(s.reason);return t().catch(l)})};let i={isUploading:!1,current:null,total:null,filename:null,completedCount:null,showCompleted:!1,checkingCount:null,totalReplays:null},U=null;function m(){const e=document.querySelector("#authenticated-state .status");if(e)if(i.showCompleted&&i.completedCount!==null){const t=i.completedCount,o=i.totalReplays!==null?` (${i.totalReplays} total)`:"";e.textContent=t>0?`Uploaded ${t} new replay${t===1?"":"s"}${o}`:`No new replays to upload${o}`}else if(i.isUploading)i.current!==null&&i.total!==null&&i.filename?e.textContent=`Uploading replay ${i.current} of ${i.total}: ${i.filename}`:i.total!==null?e.textContent=`Found ${i.total} new replay${i.total===1?"":"s"} to upload`:i.checkingCount!==null?e.textContent=`Checking ${i.checkingCount} replay${i.checkingCount===1?"":"s"} for duplicates...`:e.textContent="Scanning for replays...";else{const t=i.totalReplays!==null?` (${i.totalReplays} replays tracked)`:"";e.textContent=`Watching for new replays${t}`}}function H(e){console.log("[DEBUG] Upload started, limit:",e.limit),i.isUploading=!0,i.current=null,i.total=null,i.filename=null,i.showCompleted=!1,i.checkingCount=null,m()}function q(e){console.log("[DEBUG] Checking hashes:",e.count),i.isUploading=!0,i.checkingCount=e.count,m()}function V(e){console.log("[DEBUG] Check complete:",e.new_count,"new,",e.existing_count,"existing"),i.total=e.new_count,i.checkingCount=null,i.totalReplays=e.new_count+e.existing_count,m()}function M(e){console.log("[DEBUG] Upload progress:",e.current,"of",e.total,"-",e.filename),i.isUploading=!0,i.current=e.current,i.total=e.total,i.filename=e.filename,m()}function W(e){console.log("[DEBUG] Upload complete:",e.count,"uploaded"),i.isUploading=!1,i.current=null,i.total=null,i.filename=null,i.completedCount=e.count,i.showCompleted=!0,i.checkingCount=null,m(),U&&clearTimeout(U),U=setTimeout(()=>{i.showCompleted=!1,m()},6e4)}async function j(){try{const{listen:e}=await v(async()=>{const{listen:t}=await import("./event-OkWMoV8X.js");return{listen:t}},[]);await e("upload-start",t=>{H(t.payload)}),await e("upload-checking",t=>{q(t.payload)}),await e("upload-check-complete",t=>{V(t.payload)}),await e("upload-progress",t=>{M(t.payload)}),await e("upload-complete",t=>{W(t.payload)}),console.log("[DEBUG] Upload progress listeners initialized")}catch(e){console.error("[DEBUG] Failed to initialize upload progress listeners:",e)}}async function I(e){try{console.log("[DEBUG] Initializing upload system...");const t=p(),o=await t("load_folder_path");if(!o){console.error("[DEBUG] No folder path saved");return}await j(),console.log("[DEBUG] Upload progress listeners initialized");const r=D();console.log("[DEBUG] Using base URL:",r),await t("initialize_upload_manager",{replayFolder:o,baseUrl:r,accessToken:e}),console.log("[DEBUG] Upload manager initialized"),await t("start_file_watcher"),console.log("[DEBUG] File watcher started"),console.log("[DEBUG] Starting initial scan...");const n=await t("scan_and_upload_replays",{limit:100});console.log(`[DEBUG] Initial scan complete - uploaded ${n} replays`)}catch(t){console.error("[DEBUG] Failed to initialize upload system:",t)}}async function k(){try{g("detecting");const t=await p()("request_device_code");w("user-code",t.user_code),window.verificationUrl=t.verification_uri,g("code"),_("open-browser-btn",()=>K()),_("check-auth-btn",()=>Y(t.device_code))}catch(e){h(`Failed to request device code: ${e}`)}}async function K(){try{if(!window.verificationUrl){console.error("No verification URL available");return}await p()("open_browser",{url:window.verificationUrl})}catch(e){console.error("Failed to open browser:",e)}}async function Y(e){const t=document.getElementById("check-auth-btn");if(!t)return;const o=t.textContent||"Check Authorization";try{t.disabled=!0,t.textContent="Checking...";const r=p(),n=await r("poll_device_authorization",{deviceCode:e});w("username",n.user.username),n.user.avatar_url&&S("user-avatar",n.user.avatar_url),g("authenticated"),await r("save_auth_tokens",{accessToken:n.access_token,refreshToken:n.refresh_token||null,expiresAt:n.expires_at||null,username:n.user.username||null,avatarUrl:n.user.avatar_url||null});const{openSettings:l}=await v(async()=>{const{openSettings:a}=await import("./settings-9GN3aH7M.js");return{openSettings:a}},[]);_("settings-btn",()=>l()),await I(n.access_token)}catch(r){if(t.disabled=!1,t.textContent=o,r==="pending"){const n=document.querySelector("#code-state .status");n&&(n.textContent="Not authorized yet. Please complete authorization on the website.",setTimeout(()=>{n.textContent="After completing activation, click below:"},3e3));return}if(r==="expired"){h("Device code expired. Please try again.");return}if(r==="denied"){h("Authorization denied. Please try again.");return}console.error("Authorization error:",r),h(`Authorization failed: ${r}`)}}async function J(e){try{console.log("[DEBUG] Found saved auth tokens, verifying...");const t=p(),o=await t("verify_auth_token",{accessToken:e.access_token});if(console.log("[DEBUG] Token verification result:",o),o){g("authenticated"),e.user?(w("username",e.user.username||"Logged In"),e.user.avatar_url&&S("user-avatar",e.user.avatar_url)):w("username","Logged In");const{openSettings:r}=await v(async()=>{const{openSettings:n}=await import("./settings-9GN3aH7M.js");return{openSettings:n}},[]);return _("settings-btn",()=>r()),await I(e.access_token),!0}else return console.log("[DEBUG] Token is invalid, clearing and re-authenticating..."),await t("clear_auth_tokens"),!1}catch(t){return console.error("[DEBUG] Token verification failed:",t),await p()("clear_auth_tokens"),!1}}function Q(){_("retry-btn",()=>{console.log("[DEBUG] Retry button clicked"),location.reload()})}async function X(){console.log("[DEBUG] init() called"),L(),console.log("[DEBUG] Checking for Tauri API...");const e=await C();console.log("[DEBUG] invoke function loaded:",typeof e);try{const t=await e("load_auth_tokens");if(console.log("[DEBUG] Saved auth tokens:",t?"Found":"Not found"),t&&t.access_token&&await J(t))return;const o=await e("load_folder_path");if(console.log("[DEBUG] Saved folder path:",o),o){console.log("[DEBUG] Using saved folder, starting device auth..."),await k();return}g("detecting"),console.log("[DEBUG] Showing detecting state"),console.log("[DEBUG] Starting folder detection...");const r=await O(e);console.log("[DEBUG] Detection result:",r),r&&(console.log("[DEBUG] Found folder, starting device auth..."),await k())}catch(t){console.error("[DEBUG] Detection error:",t),$(),setTimeout(()=>{const o=document.getElementById("manual-pick-btn");o&&o.addEventListener("click",async()=>{await G()&&await k()})},100)}Q()}window.addEventListener("DOMContentLoaded",()=>{console.log("[DEBUG] DOMContentLoaded fired!"),X()});export{T as a,_ as b,h as c,p as g,g as s};
