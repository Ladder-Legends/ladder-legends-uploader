(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}})();let h=null;async function L(){var e,t,n;return h||((e=window.__TAURI_INTERNALS__)!=null&&e.invoke?(h=window.__TAURI_INTERNALS__.invoke,console.log("[DEBUG] Using __TAURI_INTERNALS__.invoke"),h):(n=(t=window.__TAURI__)==null?void 0:t.core)!=null&&n.invoke?(h=window.__TAURI__.core.invoke,console.log("[DEBUG] Using __TAURI__.core.invoke"),h):(console.error("[DEBUG] Tauri not available yet, waiting..."),await new Promise(a=>setTimeout(a,100)),L()))}function d(){if(!h)throw new Error("Tauri not initialized. Call initTauri() first.");return h}const y={detecting:null,code:null,authenticated:null,settings:null,error:null};function K(){y.detecting=document.getElementById("detecting-state"),y.code=document.getElementById("code-state"),y.authenticated=document.getElementById("authenticated-state"),y.settings=document.getElementById("settings-state"),y.error=document.getElementById("error-state")}function _(e){Object.values(y).forEach(n=>{n&&n.classList.add("hidden")});const t=y[e];t&&t.classList.remove("hidden")}function B(e){console.log("[DEBUG] Showing error:",e);const t=document.getElementById("error-message");t&&(t.textContent=e),_("error"),setTimeout(()=>{var a;const n=document.getElementById("retry-btn");if(n){const l=n.cloneNode(!0);(a=n.parentNode)==null||a.replaceChild(l,n),l.addEventListener("click",()=>{console.log("[DEBUG] Retry button clicked"),location.reload()})}},100)}const v={};function F(){const e=v==null?void 0:v.VITE_API_HOST,t=typeof window<"u"?window.LADDER_LEGENDS_API_HOST:void 0,a=e||t||"https://www.ladderlegendsacademy.com";return console.log("[CONFIG] getApiHost() called:"),console.log("  - VITE_API_HOST:",e),console.log("  - window.LADDER_LEGENDS_API_HOST:",t),console.log("  - Selected:",a),a}F();const Y=8e3,J=100;function Q(e){const t=document.getElementById(e);if(!t||!t.parentNode)return null;const n=t.cloneNode(!0);return t.parentNode.replaceChild(n,t),n}function E(e,t,n=J){setTimeout(()=>{const a=Q(e);a&&a.addEventListener("click",t)},n)}function N(e){return document.getElementById(e)}function k(e,t){const n=N(e);n&&(n.textContent=t)}function $(e,t){const n=N(e);n&&(n.src=t)}async function X(e){console.log("[DEBUG] detectWithTimeout starting (multi-folder)...");const t=e("detect_replay_folders").then(a=>{const l=a;return console.log("[DEBUG] invoke SUCCESS: found",l.length,"folder(s)"),l.forEach((r,i)=>console.log(`[DEBUG]   ${i+1}. ${r}`)),l}).catch(a=>{throw console.error("[DEBUG] invoke ERROR:",a),a}),n=new Promise((a,l)=>setTimeout(()=>{console.log("[DEBUG] Timeout reached!"),l("timeout")},Y));return Promise.race([t,n])}function Z(e){const t=document.getElementById("detecting-state");if(!t)return;const n=t.querySelector(".status");n&&(n.textContent="Could not automatically find your SC2 replay folder.");const a=t.querySelector(".spinner");if(a&&(a.style.display="none"),!document.getElementById("manual-pick-btn")){const l=document.createElement("button");l.id="manual-pick-btn",l.className="btn btn-primary",l.textContent="Choose Folder Manually",t.appendChild(l),l.addEventListener("click",()=>x())}}async function x(){try{return await d()("pick_replay_folder_manual")}catch(e){return e!=="No folder selected"&&B(`Failed to select folder: ${e}`),null}}const ee="modulepreload",te=function(e){return"/"+e},A={},C=function(t,n,a){let l=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),s=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));l=Promise.allSettled(n.map(c=>{if(c=te(c),c in A)return;A[c]=!0;const D=c.endsWith(".css"),V=D?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${V}`))return;const f=document.createElement("link");if(f.rel=D?"stylesheet":ee,D||(f.as="script"),f.crossOrigin="",f.href=c,s&&f.setAttribute("nonce",s),document.head.appendChild(f),D)return new Promise((W,j)=>{f.addEventListener("load",W),f.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(i){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=i,window.dispatchEvent(s),!s.defaultPrevented)throw i}return l.then(i=>{for(const s of i||[])s.status==="rejected"&&r(s.reason);return t().catch(r)})};function z(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}const ne={isUploading:!1,current:null,total:null,filename:null,completedCount:null,showCompleted:!1,checkingCount:null,totalReplays:null,currentBatchGameType:null,currentBatchPlayerName:null,currentBatchCount:null,backgroundDetectedCount:0,showBackgroundNotification:!1,hasError:!1,errorFilename:null,errorMessage:null};let w=[],T=null,o={...ne},b=null,P=!0;function oe(e){const t=e.split(/[/\\]/);return t[t.length-1]||e}function le(e){const t=oe(e);console.log("[DEBUG] New replay detected in background:",t),P||(w.push(t),o.backgroundDetectedCount=w.length,console.log("[DEBUG] Background replay count:",o.backgroundDetectedCount))}function ae(){if(w.length===0)return;const e=w.length;console.log("[DEBUG] Showing background notification for",e,"replay(s)"),o.showBackgroundNotification=!0,o.backgroundDetectedCount=e;const t=e===1?"Found 1 new replay while away":`Found ${e} new replays while away`;m(t,!1),w=[],T&&clearTimeout(T),T=setTimeout(()=>{o.showBackgroundNotification=!1,o.backgroundDetectedCount=0,u()},4e3)}function re(){console.log("[DEBUG] Window gained focus"),P=!0,w.length>0&&ae()}function ie(){console.log("[DEBUG] Window lost focus"),P=!1}function p(e,t){const n=document.getElementById("upload-status"),a=document.getElementById("batch-game-type"),l=document.getElementById("batch-player-name");!n||!a||!l||(e&&t?(n.classList.remove("hidden"),a.textContent=e,l.textContent=z(t)):n.classList.add("hidden"))}function g(e,t,n){const a=document.getElementById("replay-progress"),l=document.getElementById("replay-filename");!a||!l||(e!==null&&t!==null&&n?(a.textContent=`[${e}/${t}]`,l.textContent=z(n)):(a.textContent="",l.textContent=""))}function m(e,t=!1){const n=document.getElementById("watching-status");n&&(n.textContent=e,t?n.classList.add("fade-out"):n.classList.remove("fade-out"))}function se(e,t,n){const a=document.getElementById("error-container"),l=document.getElementById("error-message"),r=document.getElementById("error-filename");if(a)if(e&&n){if(a.classList.remove("hidden"),l){const i=n.length>100?n.substring(0,100)+"...":n;l.textContent=i}r&&t&&(r.textContent=t)}else a.classList.add("hidden")}function u(){if(se(o.hasError,o.errorFilename,o.errorMessage),o.hasError)m("Upload failed",!1),p(null,null),g(null,null,null);else if(o.showBackgroundNotification)p(null,null),g(null,null,null);else if(o.showCompleted&&o.completedCount!==null){const e=o.completedCount,t=o.totalReplays!==null?` (${o.totalReplays} total)`:"",n=e>0?`Uploaded ${e} new replay${e===1?"":"s"}${t}`:`No new replays to upload${t}`;m(n,!1),p(null,null),g(null,null,null)}else if(o.isUploading)o.current!==null&&o.total!==null&&o.filename?(p(o.currentBatchGameType,o.currentBatchPlayerName),g(o.current,o.total,o.filename),m("",!1)):o.total!==null?(m(`Found ${o.total} new replay${o.total===1?"":"s"} to upload`,!1),p(null,null),g(null,null,null)):o.checkingCount!==null?(m(`Checking ${o.checkingCount} replay${o.checkingCount===1?"":"s"} for duplicates...`,!1),p(null,null),g(null,null,null)):(m("Scanning for replays...",!1),p(null,null),g(null,null,null));else{const e=o.totalReplays!==null?` (${o.totalReplays} replays tracked)`:"";m(`Waiting for new replays${e}`,!1),p(null,null),g(null,null,null)}}function ce(e){console.log("[DEBUG] Upload started, limit:",e.limit),o.isUploading=!0,o.current=null,o.total=null,o.filename=null,o.showCompleted=!1,o.checkingCount=null,u()}function ue(e){console.log("[DEBUG] Checking hashes:",e.count),o.isUploading=!0,o.checkingCount=e.count,u()}function de(e){console.log("[DEBUG] Check complete:",e.new_count,"new,",e.existing_count,"existing"),o.total=e.new_count,o.checkingCount=null,o.totalReplays=e.new_count+e.existing_count,u()}function fe(e){console.log("[DEBUG] Batch started:",e.game_type,"for",e.player_name,"-",e.count,"replays"),o.currentBatchGameType=e.game_type,o.currentBatchPlayerName=e.player_name,o.currentBatchCount=e.count,u()}function pe(e){console.log("[DEBUG] Upload progress:",e.current,"of",e.total,"-",e.filename,`(${e.game_type} for ${e.player_name})`),o.isUploading=!0,o.current=e.current,o.total=e.total,o.filename=e.filename,o.currentBatchGameType=e.game_type,o.currentBatchPlayerName=e.player_name,u()}function ge(e){console.log("[DEBUG] Batch completed:",e.game_type,"for",e.player_name,"-",e.count,"replays")}function me(e){console.log("[DEBUG] Upload complete:",e.count,"uploaded"),o.isUploading=!1,o.current=null,o.total=null,o.filename=null,o.completedCount=e.count,o.showCompleted=!0,o.checkingCount=null,o.currentBatchGameType=null,o.currentBatchPlayerName=null,o.currentBatchCount=null,o.hasError=!1,o.errorFilename=null,o.errorMessage=null,u(),b&&clearTimeout(b),b=setTimeout(()=>{const t=document.querySelector("#authenticated-state .status");t&&(t.classList.add("fade-out"),setTimeout(()=>{o.showCompleted=!1,u()},1e3))},3e3)}function he(e){console.log("[DEBUG] Upload error:",e.filename,"-",e.error),o.isUploading=!1,o.hasError=!0,o.errorFilename=e.filename,o.errorMessage=e.error,o.showCompleted=!1,o.currentBatchGameType=null,o.currentBatchPlayerName=null,o.currentBatchCount=null,u()}function ye(){o.hasError=!1,o.errorFilename=null,o.errorMessage=null,u()}async function Ee(){try{const{listen:e}=await C(async()=>{const{listen:t}=await import("./event-OkWMoV8X.js");return{listen:t}},[]);await e("upload-start",t=>{ce(t.payload)}),await e("upload-checking",t=>{ue(t.payload)}),await e("upload-check-complete",t=>{de(t.payload)}),await e("upload-batch-start",t=>{fe(t.payload)}),await e("upload-progress",t=>{pe(t.payload)}),await e("upload-batch-complete",t=>{ge(t.payload)}),await e("upload-complete",t=>{me(t.payload)}),await e("upload-error",t=>{he(t.payload)}),await e("new-replay-detected",t=>{le(t.payload)}),window.addEventListener("focus",re),window.addEventListener("blur",ie),console.log("[DEBUG] Upload progress listeners initialized")}catch(e){console.error("[DEBUG] Failed to initialize upload progress listeners:",e)}}let G=!1,R=!1;async function O(e){if(G){console.log("[DEBUG] Upload system already initializing, skipping duplicate call");return}if(R){console.log("[DEBUG] Upload system already initialized, skipping duplicate call");return}G=!0;try{console.log("[DEBUG] Initializing upload system...");const t=d(),n=await t("load_folder_paths");if(!n||n.length===0){console.error("[DEBUG] No folder paths saved");const r=document.getElementById("watching-status");r&&r.classList.add("hidden");const i=document.getElementById("settings-btn");if(i&&i.parentElement){const s=document.createElement("button");s.id="pick-folder-btn",s.className="btn-secondary",s.textContent="Choose Replay Folder",s.style.marginTop="15px",i.parentElement.insertBefore(s,i),s.addEventListener("click",async()=>{await x()&&location.reload()})}return}console.log("[DEBUG] Found",n.length,"replay folder(s)"),await Ee(),console.log("[DEBUG] Upload progress listeners initialized");const a=F();console.log("[DEBUG] Using base URL:",a),await t("initialize_upload_manager",{replayFolders:n,baseUrl:a,accessToken:e}),console.log("[DEBUG] Upload manager initialized with",n.length,"folder(s)"),await t("start_file_watcher"),console.log("[DEBUG] File watcher started"),console.log("[DEBUG] Starting initial scan...");const l=await t("scan_and_upload_replays",{limit:10});console.log(`[DEBUG] Initial scan complete - uploaded ${l} replays`),R=!0}catch(t){console.error("[DEBUG] Failed to initialize upload system:",t)}finally{G=!1}}async function M(){try{console.log("[DEBUG] Retrying upload...");const e=d();ye();const t=await e("scan_and_upload_replays",{limit:10});console.log(`[DEBUG] Retry complete - uploaded ${t} replays`)}catch(e){console.error("[DEBUG] Retry failed:",e)}}async function I(){try{_("detecting");const t=await d()("request_device_code");k("user-code",t.user_code),window.verificationUrl=t.verification_uri,_("code"),E("open-browser-btn",()=>H()),E("check-auth-btn",()=>q(t.device_code))}catch(e){B(`Failed to request device code: ${e}`)}}async function H(){try{if(!window.verificationUrl){console.error("No verification URL available");return}await d()("open_browser",{url:window.verificationUrl});const t=document.getElementById("open-browser-btn"),n=document.getElementById("check-auth-section");t&&t.classList.add("hidden"),n&&n.classList.remove("hidden")}catch(e){console.error("Failed to open browser:",e)}}async function q(e){const t=document.getElementById("check-auth-btn"),n=document.getElementById("open-browser-btn");if(!t)return;const a=t.textContent||"Check Authorization";try{t.disabled=!0,t.textContent="Checking...";const l=d(),r=await l("poll_device_authorization",{deviceCode:e});k("username",r.user.username),r.user.avatar_url&&$("user-avatar",r.user.avatar_url),_("authenticated"),await l("save_auth_tokens",{accessToken:r.access_token,refreshToken:r.refresh_token||null,expiresAt:r.expires_at||null,username:r.user.username||null,avatarUrl:r.user.avatar_url||null});const{openSettings:i}=await C(async()=>{const{openSettings:s}=await import("./settings-BodegXm0.js");return{openSettings:s}},[]);E("settings-btn",()=>i()),E("retry-upload-btn",()=>M());try{const{listen:s}=await C(async()=>{const{listen:c}=await import("./event-OkWMoV8X.js");return{listen:c}},[]);await s("open-settings",()=>{i()})}catch(s){console.error("[DEBUG] Failed to setup settings event listener:",s)}await O(r.access_token)}catch(l){if(t.disabled=!1,t.textContent=a,l==="pending"){const r=document.querySelector("#code-state .status");r&&(r.textContent="Not authorized yet. Please complete authorization on the website.",setTimeout(()=>{r.textContent="After completing activation, click below:"},3e3));return}if(l==="expired"||String(l).includes("invalid")||String(l).includes("not found")){console.log("[DEBUG] Code expired/invalid, regenerating..."),await we(t,n);return}if(l==="denied"){B("Authorization denied. Please try again.");return}console.error("Authorization error:",l),B(`Authorization failed: ${l}`)}}async function we(e,t){try{e&&(e.disabled=!0,e.textContent="Getting new code...");const a=await d()("request_device_code");k("user-code",a.user_code),window.verificationUrl=a.verification_uri;const l=document.querySelector("#code-state .status");l&&(l.textContent="Code expired - here's a fresh one! Click below to continue:"),t&&(t.classList.remove("hidden"),t.onclick=()=>H());const r=document.getElementById("check-auth-section");r&&r.classList.add("hidden"),e&&(e.disabled=!1,e.textContent="Check Authorization",e.onclick=()=>q(a.device_code))}catch(n){console.error("[DEBUG] Failed to regenerate device code:",n),B("Failed to get new code. Please restart the app."),e&&(e.disabled=!1,e.textContent="Retry")}}async function _e(e){try{console.log("[DEBUG] Found saved auth tokens, verifying...");const t=d(),n=await t("verify_auth_token",{accessToken:e.access_token});if(console.log("[DEBUG] Token verification result:",n),n){_("authenticated"),e.user?(k("username",e.user.username||"Logged In"),e.user.avatar_url&&$("user-avatar",e.user.avatar_url)):k("username","Logged In");const{openSettings:a}=await C(async()=>{const{openSettings:l}=await import("./settings-BodegXm0.js");return{openSettings:l}},[]);E("settings-btn",()=>a()),E("retry-upload-btn",()=>M());try{const{listen:l}=await C(async()=>{const{listen:r}=await import("./event-OkWMoV8X.js");return{listen:r}},[]);await l("open-settings",()=>{a()})}catch(l){console.error("[DEBUG] Failed to setup settings event listener:",l)}return await O(e.access_token),!0}else return console.log("[DEBUG] Token is invalid, clearing and re-authenticating..."),await t("clear_auth_tokens"),!1}catch(t){return console.error("[DEBUG] Token verification failed:",t),await d()("clear_auth_tokens"),!1}}async function Ue(){try{const e=await L(),t=await e("get_version"),n=document.getElementById("version-text");n&&(n.textContent=`v${t}`);const a=document.getElementById("check-update-btn"),l=document.getElementById("update-badge");a&&(a.classList.remove("hidden"),a.addEventListener("click",async()=>{try{a.textContent="Checking...",await e("check_for_updates")&&l?(l.classList.remove("hidden"),a.textContent="Install Update",a.onclick=async()=>{a.textContent="Installing...",a.disabled=!0;try{await e("install_update"),a.textContent="Restarting..."}catch(i){console.error("[DEBUG] Update installation failed:",i),a.textContent="Update Failed",a.disabled=!1,alert(`Update failed: ${i}

Please try again or download the latest version from:
https://github.com/Ladder-Legends/ladder-legends-uploader/releases/latest`),setTimeout(()=>{a.textContent="Install Update"},3e3)}}):(a.textContent="Up to date!",setTimeout(()=>{a.textContent="Check for Updates"},2e3))}catch(r){console.error("[DEBUG] Update check error:",r),a.textContent="Check Failed",setTimeout(()=>{a.textContent="Check for Updates"},2e3)}}))}catch(e){console.error("[DEBUG] Failed to initialize version display:",e)}}function Be(){E("retry-btn",()=>{console.log("[DEBUG] Retry button clicked"),location.reload()})}let S=!1,U=!1;async function ke(){if(console.log("[DEBUG] init() called"),S){console.log("[DEBUG] Already initializing, skipping duplicate init() call");return}if(U){console.log("[DEBUG] Already initialized, skipping init() call");return}S=!0;try{K(),console.log("[DEBUG] Checking for Tauri API...");const e=await L();console.log("[DEBUG] invoke function loaded:",typeof e);const t=await e("load_auth_tokens");if(console.log("[DEBUG] Saved auth tokens:",t?"Found":"Not found"),t&&t.access_token&&await _e(t)){U=!0;return}const n=await e("load_folder_paths");if(console.log("[DEBUG] Saved folder paths:",(n==null?void 0:n.length)||0,"folder(s)"),n&&n.length>0){console.log("[DEBUG] Using",n.length,"saved folder(s), starting device auth..."),await I(),U=!0;return}_("detecting"),console.log("[DEBUG] Showing detecting state"),console.log("[DEBUG] Starting folder detection...");const a=await X(e);console.log("[DEBUG] Detection result:",a.length,"folder(s)"),a&&a.length>0&&(console.log("[DEBUG] Found",a.length,"folder(s), starting device auth..."),await I(),U=!0)}catch(e){console.error("[DEBUG] Detection error:",e),Z(),setTimeout(()=>{const t=document.getElementById("manual-pick-btn");t&&t.addEventListener("click",async()=>{await x()&&(await I(),U=!0)})},100)}finally{S=!1}Be()}window.addEventListener("DOMContentLoaded",()=>{console.log("[DEBUG] DOMContentLoaded fired!"),ke(),Ue()});export{N as a,E as b,B as c,d as g,_ as s};
