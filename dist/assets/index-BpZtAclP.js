(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();let d=null;async function L(){var e,t,n;return d||((e=window.__TAURI_INTERNALS__)!=null&&e.invoke?(d=window.__TAURI_INTERNALS__.invoke,console.log("[DEBUG] Using __TAURI_INTERNALS__.invoke"),d):(n=(t=window.__TAURI__)==null?void 0:t.core)!=null&&n.invoke?(d=window.__TAURI__.core.invoke,console.log("[DEBUG] Using __TAURI__.core.invoke"),d):(console.error("[DEBUG] Tauri not available yet, waiting..."),await new Promise(l=>setTimeout(l,100)),L()))}function f(){if(!d)throw new Error("Tauri not initialized. Call initTauri() first.");return d}const y={detecting:null,code:null,authenticated:null,settings:null,error:null};function j(){y.detecting=document.getElementById("detecting-state"),y.code=document.getElementById("code-state"),y.authenticated=document.getElementById("authenticated-state"),y.settings=document.getElementById("settings-state"),y.error=document.getElementById("error-state")}function w(e){Object.values(y).forEach(n=>{n&&n.classList.add("hidden")});const t=y[e];t&&t.classList.remove("hidden")}function k(e){console.log("[DEBUG] Showing error:",e);const t=document.getElementById("error-message");t&&(t.textContent=e),w("error"),setTimeout(()=>{var l;const n=document.getElementById("retry-btn");if(n){const o=n.cloneNode(!0);(l=n.parentNode)==null||l.replaceChild(o,n),o.addEventListener("click",()=>{console.log("[DEBUG] Retry button clicked"),location.reload()})}},100)}const T={};function R(){const e=T==null?void 0:T.VITE_API_HOST,t=typeof window<"u"?window.LADDER_LEGENDS_API_HOST:void 0,l=e||t||"https://www.ladderlegendsacademy.com";return console.log("[CONFIG] getApiHost() called:"),console.log("  - VITE_API_HOST:",e),console.log("  - window.LADDER_LEGENDS_API_HOST:",t),console.log("  - Selected:",l),l}R();const K=8e3,Y=100;function J(e){const t=document.getElementById(e);if(!t||!t.parentNode)return null;const n=t.cloneNode(!0);return t.parentNode.replaceChild(n,t),n}function v(e,t,n=Y){setTimeout(()=>{const l=J(e);l&&l.addEventListener("click",t)},n)}function N(e){return document.getElementById(e)}function C(e,t){const n=N(e);n&&(n.textContent=t)}function F(e,t){const n=N(e);n&&(n.src=t)}async function O(e){console.log("[DEBUG] detectWithTimeout starting (multi-folder)...");const t=e("detect_replay_folders").then(l=>{const o=l;return console.log("[DEBUG] invoke SUCCESS: found",o.length,"folder(s)"),o.forEach((i,r)=>console.log(`[DEBUG]   ${r+1}. ${i}`)),o}).catch(l=>{throw console.error("[DEBUG] invoke ERROR:",l),l}),n=new Promise((l,o)=>setTimeout(()=>{console.log("[DEBUG] Timeout reached!"),o("timeout")},K));return Promise.race([t,n])}function $(e){const t=document.getElementById("detecting-state");if(!t)return;const n=t.querySelector(".status");n&&(n.textContent="Could not automatically find your SC2 replay folder.");const l=t.querySelector(".spinner");if(l&&(l.style.display="none"),!document.getElementById("manual-pick-btn")){const o=document.createElement("button");o.id="manual-pick-btn",o.className="btn btn-primary",o.textContent="Choose Folder Manually",t.appendChild(o),o.addEventListener("click",()=>x())}}async function x(){try{return await f()("pick_replay_folder_manual")}catch(e){return e!=="No folder selected"&&k(`Failed to select folder: ${e}`),null}}const Q=Object.freeze(Object.defineProperty({__proto__:null,detectWithTimeout:O,pickFolderManually:x,showManualPickerOption:$},Symbol.toStringTag,{value:"Module"})),X="modulepreload",Z=function(e){return"/"+e},A={},_=function(t,n,l){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),s=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.allSettled(n.map(c=>{if(c=Z(c),c in A)return;A[c]=!0;const U=c.endsWith(".css"),D=U?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${D}`))return;const u=document.createElement("link");if(u.rel=U?"stylesheet":X,U||(u.as="script"),u.crossOrigin="",u.href=c,s&&u.setAttribute("nonce",s),document.head.appendChild(u),U)return new Promise((M,W)=>{u.addEventListener("load",M),u.addEventListener("error",()=>W(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(r){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=r,window.dispatchEvent(s),!s.defaultPrevented)throw r}return o.then(r=>{for(const s of r||[])s.status==="rejected"&&i(s.reason);return t().catch(i)})};function z(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}const ee={isUploading:!1,current:null,total:null,filename:null,completedCount:null,showCompleted:!1,checkingCount:null,totalReplays:null,currentBatchGameType:null,currentBatchPlayerName:null,currentBatchCount:null,backgroundDetectedCount:0,showBackgroundNotification:!1};let E=[],b=null,a={...ee},G=null,P=!0;function te(e){const t=e.split(/[/\\]/);return t[t.length-1]||e}function ne(e){const t=te(e);console.log("[DEBUG] New replay detected in background:",t),P||(E.push(t),a.backgroundDetectedCount=E.length,console.log("[DEBUG] Background replay count:",a.backgroundDetectedCount))}function oe(){if(E.length===0)return;const e=E.length;console.log("[DEBUG] Showing background notification for",e,"replay(s)"),a.showBackgroundNotification=!0,a.backgroundDetectedCount=e;const t=e===1?"Found 1 new replay while away":`Found ${e} new replays while away`;h(t,!1),E=[],b&&clearTimeout(b),b=setTimeout(()=>{a.showBackgroundNotification=!1,a.backgroundDetectedCount=0,g()},4e3)}function le(){console.log("[DEBUG] Window gained focus"),P=!0,E.length>0&&oe()}function ae(){console.log("[DEBUG] Window lost focus"),P=!1}function p(e,t){const n=document.getElementById("upload-status"),l=document.getElementById("batch-game-type"),o=document.getElementById("batch-player-name");!n||!l||!o||(e&&t?(n.classList.remove("hidden"),l.textContent=e,o.textContent=z(t)):n.classList.add("hidden"))}function m(e,t,n){const l=document.getElementById("replay-progress"),o=document.getElementById("replay-filename");!l||!o||(e!==null&&t!==null&&n?(l.textContent=`[${e}/${t}]`,o.textContent=z(n)):(l.textContent="",o.textContent=""))}function h(e,t=!1){const n=document.getElementById("watching-status");n&&(n.textContent=e,t?n.classList.add("fade-out"):n.classList.remove("fade-out"))}function g(){if(a.showBackgroundNotification)p(null,null),m(null,null,null);else if(a.showCompleted&&a.completedCount!==null){const e=a.completedCount,t=a.totalReplays!==null?` (${a.totalReplays} total)`:"",n=e>0?`Uploaded ${e} new replay${e===1?"":"s"}${t}`:`No new replays to upload${t}`;h(n,!1),p(null,null),m(null,null,null)}else if(a.isUploading)a.current!==null&&a.total!==null&&a.filename?(p(a.currentBatchGameType,a.currentBatchPlayerName),m(a.current,a.total,a.filename),h("",!1)):a.total!==null?(h(`Found ${a.total} new replay${a.total===1?"":"s"} to upload`,!1),p(null,null),m(null,null,null)):a.checkingCount!==null?(h(`Checking ${a.checkingCount} replay${a.checkingCount===1?"":"s"} for duplicates...`,!1),p(null,null),m(null,null,null)):(h("Scanning for replays...",!1),p(null,null),m(null,null,null));else{const e=a.totalReplays!==null?` (${a.totalReplays} replays tracked)`:"";h(`Waiting for new replays${e}`,!1),p(null,null),m(null,null,null)}}function ie(e){console.log("[DEBUG] Upload started, limit:",e.limit),a.isUploading=!0,a.current=null,a.total=null,a.filename=null,a.showCompleted=!1,a.checkingCount=null,g()}function re(e){console.log("[DEBUG] Checking hashes:",e.count),a.isUploading=!0,a.checkingCount=e.count,g()}function se(e){console.log("[DEBUG] Check complete:",e.new_count,"new,",e.existing_count,"existing"),a.total=e.new_count,a.checkingCount=null,a.totalReplays=e.new_count+e.existing_count,g()}function ce(e){console.log("[DEBUG] Batch started:",e.game_type,"for",e.player_name,"-",e.count,"replays"),a.currentBatchGameType=e.game_type,a.currentBatchPlayerName=e.player_name,a.currentBatchCount=e.count,g()}function ue(e){console.log("[DEBUG] Upload progress:",e.current,"of",e.total,"-",e.filename,`(${e.game_type} for ${e.player_name})`),a.isUploading=!0,a.current=e.current,a.total=e.total,a.filename=e.filename,a.currentBatchGameType=e.game_type,a.currentBatchPlayerName=e.player_name,g()}function de(e){console.log("[DEBUG] Batch completed:",e.game_type,"for",e.player_name,"-",e.count,"replays")}function fe(e){console.log("[DEBUG] Upload complete:",e.count,"uploaded"),a.isUploading=!1,a.current=null,a.total=null,a.filename=null,a.completedCount=e.count,a.showCompleted=!0,a.checkingCount=null,a.currentBatchGameType=null,a.currentBatchPlayerName=null,a.currentBatchCount=null,g(),G&&clearTimeout(G),G=setTimeout(()=>{const t=document.querySelector("#authenticated-state .status");t&&(t.classList.add("fade-out"),setTimeout(()=>{a.showCompleted=!1,g()},1e3))},3e3)}async function ge(){try{const{listen:e}=await _(async()=>{const{listen:t}=await import("./event-OkWMoV8X.js");return{listen:t}},[]);await e("upload-start",t=>{ie(t.payload)}),await e("upload-checking",t=>{re(t.payload)}),await e("upload-check-complete",t=>{se(t.payload)}),await e("upload-batch-start",t=>{ce(t.payload)}),await e("upload-progress",t=>{ue(t.payload)}),await e("upload-batch-complete",t=>{de(t.payload)}),await e("upload-complete",t=>{fe(t.payload)}),await e("new-replay-detected",t=>{ne(t.payload)}),window.addEventListener("focus",le),window.addEventListener("blur",ae),console.log("[DEBUG] Upload progress listeners initialized")}catch(e){console.error("[DEBUG] Failed to initialize upload progress listeners:",e)}}async function H(e){try{console.log("[DEBUG] Initializing upload system...");const t=f(),n=await t("load_folder_paths");if(!n||n.length===0){console.error("[DEBUG] No folder paths saved");const i=document.getElementById("watching-status");i&&i.classList.add("hidden");const r=document.getElementById("settings-btn");if(r&&r.parentElement){const s=document.createElement("button");s.id="pick-folder-btn",s.className="btn-secondary",s.textContent="Choose Replay Folder",s.style.marginTop="15px",r.parentElement.insertBefore(s,r),s.addEventListener("click",async()=>{const{pickFolderManually:c}=await _(async()=>{const{pickFolderManually:D}=await Promise.resolve().then(()=>Q);return{pickFolderManually:D}},void 0);await c()&&location.reload()})}return}console.log("[DEBUG] Found",n.length,"replay folder(s)"),await ge(),console.log("[DEBUG] Upload progress listeners initialized");const l=R();console.log("[DEBUG] Using base URL:",l),await t("initialize_upload_manager",{replayFolders:n,baseUrl:l,accessToken:e}),console.log("[DEBUG] Upload manager initialized with",n.length,"folder(s)"),await t("start_file_watcher"),console.log("[DEBUG] File watcher started"),console.log("[DEBUG] Starting initial scan...");const o=await t("scan_and_upload_replays",{limit:10});console.log(`[DEBUG] Initial scan complete - uploaded ${o} replays`)}catch(t){console.error("[DEBUG] Failed to initialize upload system:",t)}}async function I(){try{w("detecting");const t=await f()("request_device_code");C("user-code",t.user_code),window.verificationUrl=t.verification_uri,w("code"),v("open-browser-btn",()=>V()),v("check-auth-btn",()=>q(t.device_code))}catch(e){k(`Failed to request device code: ${e}`)}}async function V(){try{if(!window.verificationUrl){console.error("No verification URL available");return}await f()("open_browser",{url:window.verificationUrl});const t=document.getElementById("open-browser-btn"),n=document.getElementById("check-auth-section");t&&t.classList.add("hidden"),n&&n.classList.remove("hidden")}catch(e){console.error("Failed to open browser:",e)}}async function q(e){const t=document.getElementById("check-auth-btn"),n=document.getElementById("open-browser-btn");if(!t)return;const l=t.textContent||"Check Authorization";try{t.disabled=!0,t.textContent="Checking...";const o=f(),i=await o("poll_device_authorization",{deviceCode:e});C("username",i.user.username),i.user.avatar_url&&F("user-avatar",i.user.avatar_url),w("authenticated"),await o("save_auth_tokens",{accessToken:i.access_token,refreshToken:i.refresh_token||null,expiresAt:i.expires_at||null,username:i.user.username||null,avatarUrl:i.user.avatar_url||null});const{openSettings:r}=await _(async()=>{const{openSettings:s}=await import("./settings-I_2onIGx.js");return{openSettings:s}},[]);v("settings-btn",()=>r());try{const{listen:s}=await _(async()=>{const{listen:c}=await import("./event-OkWMoV8X.js");return{listen:c}},[]);await s("open-settings",()=>{r()})}catch(s){console.error("[DEBUG] Failed to setup settings event listener:",s)}await H(i.access_token)}catch(o){if(t.disabled=!1,t.textContent=l,o==="pending"){const i=document.querySelector("#code-state .status");i&&(i.textContent="Not authorized yet. Please complete authorization on the website.",setTimeout(()=>{i.textContent="After completing activation, click below:"},3e3));return}if(o==="expired"||String(o).includes("invalid")||String(o).includes("not found")){console.log("[DEBUG] Code expired/invalid, regenerating..."),await pe(t,n);return}if(o==="denied"){k("Authorization denied. Please try again.");return}console.error("Authorization error:",o),k(`Authorization failed: ${o}`)}}async function pe(e,t){try{e&&(e.disabled=!0,e.textContent="Getting new code...");const l=await f()("request_device_code");C("user-code",l.user_code),window.verificationUrl=l.verification_uri;const o=document.querySelector("#code-state .status");o&&(o.textContent="Code expired - here's a fresh one! Click below to continue:"),t&&(t.classList.remove("hidden"),t.onclick=()=>V());const i=document.getElementById("check-auth-section");i&&i.classList.add("hidden"),e&&(e.disabled=!1,e.textContent="Check Authorization",e.onclick=()=>q(l.device_code))}catch(n){console.error("[DEBUG] Failed to regenerate device code:",n),k("Failed to get new code. Please restart the app."),e&&(e.disabled=!1,e.textContent="Retry")}}async function me(e){try{console.log("[DEBUG] Found saved auth tokens, verifying...");const t=f(),n=await t("verify_auth_token",{accessToken:e.access_token});if(console.log("[DEBUG] Token verification result:",n),n){w("authenticated"),e.user?(C("username",e.user.username||"Logged In"),e.user.avatar_url&&F("user-avatar",e.user.avatar_url)):C("username","Logged In");const{openSettings:l}=await _(async()=>{const{openSettings:o}=await import("./settings-I_2onIGx.js");return{openSettings:o}},[]);v("settings-btn",()=>l());try{const{listen:o}=await _(async()=>{const{listen:i}=await import("./event-OkWMoV8X.js");return{listen:i}},[]);await o("open-settings",()=>{l()})}catch(o){console.error("[DEBUG] Failed to setup settings event listener:",o)}return await H(e.access_token),!0}else return console.log("[DEBUG] Token is invalid, clearing and re-authenticating..."),await t("clear_auth_tokens"),!1}catch(t){return console.error("[DEBUG] Token verification failed:",t),await f()("clear_auth_tokens"),!1}}async function he(){try{const e=await L(),t=await e("get_version"),n=document.getElementById("version-text");n&&(n.textContent=`v${t}`);const l=document.getElementById("check-update-btn"),o=document.getElementById("update-badge");l&&(l.classList.remove("hidden"),l.addEventListener("click",async()=>{try{l.textContent="Checking...",await e("check_for_updates")&&o?(o.classList.remove("hidden"),l.textContent="Install Update",l.onclick=async()=>{l.textContent="Installing...",l.disabled=!0;try{await e("install_update"),l.textContent="Restarting..."}catch(r){console.error("[DEBUG] Update installation failed:",r),l.textContent="Update Failed",l.disabled=!1,alert(`Update failed: ${r}

Please try again or download the latest version from:
https://github.com/Ladder-Legends/ladder-legends-uploader/releases/latest`),setTimeout(()=>{l.textContent="Install Update"},3e3)}}):(l.textContent="Up to date!",setTimeout(()=>{l.textContent="Check for Updates"},2e3))}catch(i){console.error("[DEBUG] Update check error:",i),l.textContent="Check Failed",setTimeout(()=>{l.textContent="Check for Updates"},2e3)}}))}catch(e){console.error("[DEBUG] Failed to initialize version display:",e)}}function ye(){v("retry-btn",()=>{console.log("[DEBUG] Retry button clicked"),location.reload()})}let S=!1,B=!1;async function Ee(){if(console.log("[DEBUG] init() called"),S){console.log("[DEBUG] Already initializing, skipping duplicate init() call");return}if(B){console.log("[DEBUG] Already initialized, skipping init() call");return}S=!0;try{j(),console.log("[DEBUG] Checking for Tauri API...");const e=await L();console.log("[DEBUG] invoke function loaded:",typeof e);const t=await e("load_auth_tokens");if(console.log("[DEBUG] Saved auth tokens:",t?"Found":"Not found"),t&&t.access_token&&await me(t)){B=!0;return}const n=await e("load_folder_paths");if(console.log("[DEBUG] Saved folder paths:",(n==null?void 0:n.length)||0,"folder(s)"),n&&n.length>0){console.log("[DEBUG] Using",n.length,"saved folder(s), starting device auth..."),await I(),B=!0;return}w("detecting"),console.log("[DEBUG] Showing detecting state"),console.log("[DEBUG] Starting folder detection...");const l=await O(e);console.log("[DEBUG] Detection result:",l.length,"folder(s)"),l&&l.length>0&&(console.log("[DEBUG] Found",l.length,"folder(s), starting device auth..."),await I(),B=!0)}catch(e){console.error("[DEBUG] Detection error:",e),$(),setTimeout(()=>{const t=document.getElementById("manual-pick-btn");t&&t.addEventListener("click",async()=>{await x()&&(await I(),B=!0)})},100)}finally{S=!1}ye()}window.addEventListener("DOMContentLoaded",()=>{console.log("[DEBUG] DOMContentLoaded fired!"),Ee(),he()});export{N as a,v as b,k as c,f as g,w as s};
